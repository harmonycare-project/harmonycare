ã…Šdex})">ì‚­ì œ</button>
                `;
                scheduleList.appendChild(li);
            });
            // â­ï¸ ì˜¤ë²„ë ˆì´ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
            renderOverlay(); 
        }

        function addItem() {
            if (timeInput.value && activityInput.value) {
                schedule.push({ 
                    time: timeInput.value, 
                    activity: activityInput.value, 
                    completed: false,
                    notified: false,
                    lastNagged: null
                });
                timeInput.value = '';
                activityInput.value = '';
                saveSchedule();
                renderSchedule();
            } else {
                alert('ì‹œê°„ê³¼ í•  ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        function toggleComplete(index) {
            schedule[index].completed = !schedule[index].completed;
            if (schedule[index].completed) {
                schedule[index].notified = false;
                schedule[index].lastNagged = null; // ì¬ì´‰ ê¸°ë¡ ì´ˆê¸°í™”
            }
            saveSchedule();
            renderSchedule();
        }

        function deleteItem(index) {
            schedule.splice(index, 1);
            saveSchedule();
            renderSchedule();
        }

        function goBack() {
            history.back();
        }

        function goHome() {
            location.href = 'main.html';
        }

        addBtn.addEventListener('click', addItem);
        activityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addItem();
        });

        // --- ì•ŒëŒ ê¸°ëŠ¥ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ ---
        function checkAlarms() {
            const now = new Date();
            const currentHour = String(now.getHours()).padStart(2, '0');
            const currentMinute = String(now.getMinutes()).padStart(2, '0');
            const currentTime = `${currentHour}:${currentMinute}`;
            const oneMinuteAgo = now.getTime() - (1 * 60 * 1000);

            schedule.forEach((item) => {
                if (item.completed) return; // ì™„ë£Œëœ í•­ëª©ì€ ê±´ë„ˆëœ€

                // 1. ì •ì‹œ ì•Œë¦¼
                if (!item.notified && item.time === currentTime) {
                    alarmSound.play();
                    alert(`â° ${item.activity} í•  ì‹œê°„ì´ì—ìš”!`);
                    item.notified = true;
                    saveSchedule();
                }

                // 2. ì¬ì´‰ ì•Œë¦¼
                const lastNaggedTime = item.lastNagged ? new Date(item.lastNagged).getTime() : 0;
                if (item.time < currentTime && lastNaggedTime < oneMinuteAgo) {
                    alarmSound.play();
                    alert(`ğŸƒ ì•„ì§ '${item.activity}'ì„(ë¥¼) ì™„ë£Œí•˜ì§€ ì•Šì•˜ì–´ìš”! ì„œë‘ë¥´ì„¸ìš”!`);
                    item.lastNagged = now.toISOString();
                    saveSchedule();
                }
            });
        }

        setInterval(checkAlarms, 1000);

        // â­ï¸ DOMContentLoadedì—ì„œ ë Œë”ë§ ì‹œì‘ ë° ì˜¤ë²„ë ˆì´ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
             renderSchedule(); // ì£¼ìš” ì¼ì • ë¦¬ìŠ¤íŠ¸ ë° ì˜¤ë²„ë ˆì´ ë Œë”ë§ ì‹œì‘
        });
        
        // â­ï¸ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œë„ ì˜¤ë²„ë ˆì´ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆë„ë¡ ì „ì—­ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        // ì´ ë¶€ë¶„ì€ í•´ë‹¹ íŒŒì¼ì—ì„œë§Œ í•„ìš”í•˜ë¯€ë¡œ, ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œëŠ” ì´ í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
        window.renderGlobalScheduleOverlay = renderOverlay; 
        
    </script>
</body>
ã…Šdex})">ì‚­ì œ</button>
                `;
                scheduleList.appendChild(li);
            });
            // â­ï¸ ì˜¤ë²„ë ˆì´ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
            renderOverlay(); 
        }

        function addItem() {
            if (timeInput.value && activityInput.value) {
                schedule.push({ 
                    time: timeInput.value, 
                    activity: activityInput.value, 
                    completed: false,
                    notified: false,
                    lastNagged: null
                });
                timeInput.value = '';
                activityInput.value = '';
                saveSchedule();
                renderSchedule();
            } else {
                alert('ì‹œê°„ê³¼ í•  ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        function toggleComplete(index) {
            schedule[index].completed = !schedule[index].completed;
            if (schedule[index].completed) {
                schedule[index].notified = false;
                schedule[index].lastNagged = null; // ì¬ì´‰ ê¸°ë¡ ì´ˆê¸°í™”
            }
            saveSchedule();
            renderSchedule();
        }

        function deleteItem(index) {
            schedule.splice(index, 1);
            saveSchedule();
            renderSchedule();
        }

        function goBack() {
            history.back();
        }

        function goHome() {
            location.href = 'main.html';
        }

        addBtn.addEventListener('click', addItem);
        activityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addItem();
        });

        // --- ì•ŒëŒ ê¸°ëŠ¥ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ ---
        function checkAlarms() {
            const now = new Date();
            const currentHour = String(now.getHours()).padStart(2, '0');
            const currentMinute = String(now.getMinutes()).padStart(2, '0');
            const currentTime = `${currentHour}:${currentMinute}`;
            const oneMinuteAgo = now.getTime() - (1 * 60 * 1000);

            schedule.forEach((item) => {
                if (item.completed) return; // ì™„ë£Œëœ í•­ëª©ì€ ê±´ë„ˆëœ€

                // 1. ì •ì‹œ ì•Œë¦¼
                if (!item.notified && item.time === currentTime) {
                    alarmSound.play();
                    alert(`â° ${item.activity} í•  ì‹œê°„ì´ì—ìš”!`);
                    item.notified = true;
                    saveSchedule();
                }

                // 2. ì¬ì´‰ ì•Œë¦¼
                const lastNaggedTime = item.lastNagged ? new Date(item.lastNagged).getTime() : 0;
                if (item.time < currentTime && lastNaggedTime < oneMinuteAgo) {
                    alarmSound.play();
                    alert(`ğŸƒ ì•„ì§ '${item.activity}'ì„(ë¥¼) ì™„ë£Œí•˜ì§€ ì•Šì•˜ì–´ìš”! ì„œë‘ë¥´ì„¸ìš”!`);
                    item.lastNagged = now.toISOString();
                    saveSchedule();
                }
            });
        }

        setInterval(checkAlarms, 1000);

        // â­ï¸ DOMContentLoadedì—ì„œ ë Œë”ë§ ì‹œì‘ ë° ì˜¤ë²„ë ˆì´ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
             renderSchedule(); // ì£¼ìš” ì¼ì • ë¦¬ìŠ¤íŠ¸ ë° ì˜¤ë²„ë ˆì´ ë Œë”ë§ ì‹œì‘
        });
        
        // â­ï¸ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œë„ ì˜¤ë²„ë ˆì´ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆë„ë¡ ì „ì—­ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        // ì´ ë¶€ë¶„ì€ í•´ë‹¹ íŒŒì¼ì—ì„œë§Œ í•„ìš”í•˜ë¯€ë¡œ, ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œëŠ” ì´ í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
        window.renderGlobalScheduleOverlay = renderOverlay; 
        
    </script>
</body>
</html>
